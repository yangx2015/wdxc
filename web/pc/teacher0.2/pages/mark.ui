<template>
<ui-page style="overflow:hidden">
  <ui-nav-bar slot="nav-bar" custom-style="{{ {'color':'#fff','background-color':'#FC8609'} }}">
        <ui-row height="46">
          <ui-col vertical-align="middle" align="center" width="60" bindtap="Goback">
            <ui-icon type="left" size="16" color="#fff"></ui-icon>
          </ui-col>
          <ui-col vertical-align="middle" align="center">
            <ui-view class="nav_title">详情与评价</ui-view>
          </ui-col>
          <ui-col vertical-align="middle" align="center" width="60">
          </ui-col>
        </ui-row>
    </ui-nav-bar>
    <ui-view class="box_col" style="{{{height:pageHeight(0)+'px',background:'#0f0'}}}">
      <ui-view class="getmess">
        <ui-row vertical-align="middle"  border-bottom style="padding:10px 15px 10px 0px" >
          <ui-col align="left" span=3 space-left="75" >
            <ui-view calss="pingyi">
              <ui-icon type="head-g" size=35 style="color:#888888"></ui-icon>
            </ui-view>
          </ui-col>
          <ui-col span=3 align="left" space-left="20">
            <ui-view style="color: #686868;font-size:15px;font-weight:700;">
              {{orderMess.sjxm}}
            </ui-view>
          </ui-col>
          <ui-col align="left" span=4> 
          <ui-icon type="qichemoren" size=28 style="color:#888888"></ui-icon>
          </ui-col>
          <ui-col align="left" span=4 space-right="20">
          <ui-view style="color: #686868;font-size:15px;font-weight:700;">
            {{orderMess.cph}}
          </ui-view>
          <ui-view style="color:#A0A0A0;font-size:20px">
            {{orderMess.zws}} 座车
          </ui-view> 
          </ui-col>
      </ui-row>
<ui-view>
  <ui-row vertical-align="middle">
    <ui-col align="center" style="color:#000000">
      总价
    </ui-col>
  </ui-row>
  <ui-row vertical-align="middle" style="color:#686868;font-size:25px;font-weight:700">
    <ui-col align="center">
        {{orderMess.zj}}元
    </ui-col>
  </ui-row >
  <ui-row vertical-align="middle" style="padding:0px 0px 0px 0px;color:#686868;font-size:15px">
    <ui-col align="left" space-left="20">
      过桥费:{{orderMess.gqf}}元
    </ui-col>
    <ui-col align="right" space-right="20">
      路停费:{{orderMess.lcf}}元
    </ui-col>
  </ui-row>
  <ui-row vertical-align="middle" style="margin:20px 0px 20px 0px;color:#686868;" border-bottom>
    <ui-col align="left" space-left="20" >
      里程:{{orderMess.lc}}公里
    </ui-col>
    <ui-col align="right" space-right="20">
      单价:{{orderMess.dj}}元
    </ui-col>
  </ui-row>
</ui-view>

<ui-row style="padding:20px 0px 10px 0px" vertical-align="middle">
  <ui-col align="center" style="color:#A0A0A0">
    {{starResult}}
  </ui-col>
</ui-row>
<ui-row>
  <ui-col align="left" space-left="120">
    <ui-star value="{{orderMess.pjdj}}" bindchange="pingfen" readonly="{{orderMess.pjdj !=''}}"></ui-star>
  </ui-col> 
</ui-row>



 </ui-view>

  <ui-view class="box_col_100" style="{{{backgroundImage:'url(http://api.map.baidu.com/staticimage?ak=evDHwrRoILvlkrvaZEFiGp30'+
   '&width=400&height=300'+
  '&center=114.368107,30.543083'+
  '&zoom=12'+
  '&markers=116.351296,39.907825|116.344397,39.942352'+
  '&markerStyles=-1,'+
  'http://47.98.39.45:9092/icon/map_line_begin.png|-1,http://47.98.39.45:9092/icon/map_line_end.png)'}}}">
   
  </ui-view>
</ui-view>
 
 </ui-page>
  
</template>

<script>
export default {
  config: {
    navigationBarTitleText: '订单详情',
    navigationBarBackgroundColor: '#39f',
    navigationBarBorderColor: '#39f',
    navigationBarTextStyle: 'white'
  },
  data () {
    return {
      points:[],
      starResult: '评价本次服务',
      orderMess:{},
      pageheight:ui.DEFAULT_HEADER_HEIGHT,
      current9:0,
      activeTabStyle2:{
       'color':'#FF9966',
       'border-bottom':'1px solid #FF9966',
      },
    }   
  },
      
  methods: {
    pingfen(index){
      if(this.orderMess.pjdj!=""){
        ui.showToast({ title: '该订单已评价!'})
        return
      }
      console.log(index)
      if (index === 1) {
        this.starResult = '非常差'
      } else if (index === 2) {
        this.starResult = '感觉一般'
      } else if (index === 3) {
        this.starResult = '满意，感觉不错'
      } else if (index === 4) {
        this.starResult = '很满意'
      } else if (index === 5) {
        this.starResult = '非常棒，五星好评'
      }
      this.getMarkList(index)
    },
    getMarkList(index){
      this.$http('POST',ui.getApp().apis.PJDD.QUERTY,{orderId:this.orderMess.id,grade:index},(res)=>{
        console.log("##########################",res)
      })
    },
     Goback(){
      ui.navigateBack()
    },
    handleChange(index,key){
      this[key]=index
    },
    handleContentChange(index,key){
      this[key]=index
    },
    navHandle () {
      ui.navigateTo({
        url: '/pages/detail'
      })
    },
    getDdGpsList(){
      this.$http('POST',ui.getApp().apis.HISTORYGJ,{orderID: this.orderMess.id},(res)=>{
        
        if(res.code === 200){
          this.points= res.result;
          if(this.points.length === 0){
            ui.showToast({title: 'ssssss'});
          }
        }else{
          alert('aaaaa')
          ui.showToast({title: res.message});
        }
      })
    },
    showLine(points){
      let ps = [];
      for (let r of points){
          ps.push(new BMap.Point(r.lng, r.lat));
      }
      var polyline = new BMap.Polyline(ps,
          {strokeColor:"blue", strokeWeight:6, strokeOpacity:0.5}
      );
      this.map.addOverlay(polyline);
    }
  },
  created(){
    // this.getMarkList()
    console.log("xiangqing",ui.getApp().orderMess);
    this.orderMess = ui.getApp().orderMess
    if(this.orderMess.id == undefined){
      this.Goback()
      ui.showToast({ title: '数据丢失，请重新查看' })
    }
    this.getDdGpsList();
    
  },
  mounted() {
    //首屏页面需要在mounted中延时才能调用框架api，其他页面不需要延时
    setTimeout(() => {
      //关闭app启动图
      ui.closeSplashscreen()
    }, 1000);
  }
}

</script>

 <style lang="less">
.getmess{
  background-color:#ffffff;
  height:600rpx;
}
.pingyi{
  transform: translate(-50%,0%);
}
</style>