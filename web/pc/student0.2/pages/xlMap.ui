<!---->
<template>
  <ui-page  style="overflow-y: hidden;">
    <ui-nav-bar slot="nav-bar" custom-style="{{ {'color':'#fff','background-color':'#FC8609'} }}">
        <ui-row height="46">
          <ui-col vertical-align="middle" align="center" width="60" bindtap="Goback">
            <ui-icon type="left" size="16" color="#fff"></ui-icon>
          </ui-col>
          <ui-col vertical-align="middle" align="center">
            <ui-view class="nav_title">地图查看</ui-view>
          </ui-col>
          <ui-col vertical-align="middle" align="center" width="60">
          </ui-col>
        </ui-row>
      </ui-nav-bar>
      <ui-view class="box_col" style="{{ { height: pageHeight(0)+ 'px'} }}">
         
         <!-- <ui-view style="height:200px;overflow: auto;">
              <ui-view class="box_row_z">
                  <ui-view style="padding:0 50px" ui:for="{{100}}">
                    123
                  </ui-view>
              </ui-view>
          </ui-view>
          <ui-view class="box_col_auto"> -->
<!-- 页面内容 start-->

                <ui-view id="allmap" style="{{{height:height+'px'}}}"></ui-view>

            
<!-- 页面内容 end-->

          </ui-view>

  </ui-page>
</template>

<script>
export default {
  config: {
    navigationStyle: 'custom',
    navigationBarBackgroundColor:"#26a2ff",
    navigationBarTextStyle:"white",
    navigationBarTitleText:"地图查看",
    title:'地图查看',
    backgroundColor:'#f2f2f2',
    delay:false,//延迟加载
  },
  data() {
    return {
      thisIndex:5,
      height:ui.WIN_HEIGHT,
      map:'',
      item:[
        {Icon:"../static/img/Bus.png",}
      ],
      carList:[
          // {
          //   jd :"114.378117",
          //   wd : "30.543083",
          // },
          // {
          //   jd :"114.378117",
          //   wd : "30.543073",
          // },
          // {
          //   jd :"114.378917",
          //   wd : "30.543183",
          // },
      ],
      xlID:''
    }
  },
  created(){
    this.xlID= ui.getApp().station.xlID
    this.getBusCode()
  },
  methods: {
    getBusCode(){
      this.$http('POST',ui.getApp().apis.XLMAP,{xlId:this.xlID},(res)=>{
          console.log('数据请求====',res);
          this.carList = res.result
      })
    },
    goXlMess () {
      ui.navigateTo({
        url: '/pages/xlMess'
      })
    },
    Goback(){
      ui.navigateBack()
    },
    addMarker(item, point) {
        var myIcon = new BMap.Icon("/static/img/bus2.png", new BMap.Size(50,50),{imageSize: new BMap.Size(50,50),anchor: new BMap.Size(25, 25)} );
        
      // var myIcon = new BMap.Icon(v.getIcon(item), new BMap.Size(32, 32), {anchor: new BMap.Size(16, 32)});
      var marker = new BMap.Marker(point,{icon:myIcon});
      this.map.addOverlay(marker);
      // this.addClickHandler(item, marker);
    },
    showCarPosition() {
      var v = this
      for (let r of this.carList) {
          var point = new BMap.Point(r.jd, r.wd);
          this.addMarker(r, point);
        }
    },
  },
  mounted() {
    var script = document.createElement("script")
    script.type = "text/javascript"
    var callbackName = '_callback'+Date.now()
    let v = this;
    window[callbackName]= function(){
     console.log(BMap)
      v.map = new BMap.Map("allmap");    // 创建Map实例
      v.map.centerAndZoom(new BMap.Point(114.368107 , 30.543083), 11);  // 初始化地图,设置中心点坐标和地图级别
      var point = new BMap.Point(114.368107, 30.543083);
      v.map.centerAndZoom(point, 15);    
      // var marker = new BMap.Marker(point);
      // v.map.addOverlay(marker);     
      for (let r of v.carList) {
          var point = new BMap.Point(r.jd, r.wd);
          v.addMarker(r, point);
        };
      
      
      // 自定义icon,创建标注
        
// 创建标注
        // v.map.addOverlay(marker2); 
      
      
      //添加地图类型控件
      v.map.addControl(new BMap.MapTypeControl({
        mapTypes:[
                BMAP_NORMAL_MAP,
                BMAP_HYBRID_MAP
            ]}));   
      v.map.setCurrentCity("武汉");          // 设置地图显示的城市 此项是必须设置的
      v.map.enableScrollWheelZoom(true);     //开启鼠标滚轮缩放
      delete window[callbackName];
    }
    script.src="https://api.map.baidu.com/api?v=2.0&ak=mSjqt13IyQy0GOlkAEGBO5FA2aiIT4q7&callback="+callbackName
    document.body.appendChild(script)

  }
  
}
</script>

<style lang="less">
.lineMess{
  .ui-timeline-wrapper{
    .ui-timeline-row{
      overflow: auto;
      ul{
        display: flex;
        flex-direction: row ;
        flex-wrap:nowrap ;
        height: 100%;
      }
    }
  }
}
</style>
