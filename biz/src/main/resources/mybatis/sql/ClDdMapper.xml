<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.ldz.biz.module.mapper.ClDdMapper">

    <select id="DdTongji" resultType="com.ldz.biz.module.model.ClDd" parameterType="com.ldz.biz.module.bean.DdTongjiTJ">
        select * from CL_DD t where t.CJSJ between
        #{kssj}
        and
        #{jssj}
        <if test="jgdm != null">
            and t.JGDM = #{jgdm}
        </if>
        <if test="jgdmlike != null">
            and t.JGDM like '${jgdmlike}%'
        </if>
        <if test="sjxm != null and sjxm != ''">
            and t.sjxm like '%${sjxm}%'
        </if>
    </select>

    <select id="weekTj" resultType="com.ldz.biz.module.bean.DdTjTx" parameterType="com.ldz.biz.module.bean.DdTongjiTJ">
        <!--SELECT
             t1.today,
             count (CL_DD.cjsj)
         VALUE
         FROM
             (
                 <![CDATA[ select

        to_char (to_date(#{cxsj},'yyyy-mm-dd')-to_char(sysdate,'d')+14 - LEVEL, 'yyyy-mm-dd') today  from dual   connect BY LEVEL <= 7 ]]>
            ) t1
         LEFT JOIN CL_DD ON t1.today = to_char(CL_DD.cjsj,'yyyy-mm-dd')
               <if test="jgdm != null">
                    and JGDM = #{jgdm}
                </if>
             <if test="jgdmlike != null">
                    and JGDM like '${jgdmlike}%'
                </if>
         GROUP BY
             t1.today ORDER BY t1.today-->
        select
           a.date today ,
           count(CJSJ) VALUE
        from
           cl_dd RIGHT JOIN
        ( SELECT
             DATE_FORMAT( ADDDATE(#{cxsj},INTERVAL @d DAY),'%Y-%m-%d') date ,
             @d :=@d + 1 day
          FROM cl_dd, (SELECT @d := 0) temp
          WHERE
             ADDDATE(#{cxsj},INTERVAL @d DAY) &lt;= DATE_ADD(#{cxsj},INTERVAL 6 DAY)
          ORDER BY
          day
        ) a
        on
        DATE_FORMAT(CJSJ,'%Y-%m-%d') = a.date
        <if test="jgdm != null">
            and JGDM = #{jgdm}
        </if>
        <if test="jgdmlike != null">
            and JGDM like '${jgdmlike}%'
        </if>
        GROUP BY DATE_FORMAT(a.date,'%Y-%m-%d')
        order BY a.day
    </select>

</mapper>
